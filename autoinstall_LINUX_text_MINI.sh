#!/bin/bash
#yum_core=`yum groups info core 2> /dev/null | head -53 | tail -48`
#yum_base=`yum groups info base 2> /dev/null | head -30 | tail -25`
cdrom='/mnt'
umount /dev/sr0 2> /dev/null
mount /dev/sr0 /mnt 1> /dev/null && echo "waiting..."
[ -d ./iso_auto ] || mkdir iso_auto
cd ./iso_auto
cp -rf ${cdrom}/isolinux .
cp -rf ${cdrom}/repodata .
cp -rf ${cdrom}/LiveOS .
pack="systemd-sysv-219-30.el7.x86_64 redhat-release-server-7.3-7.el7.x86_64 polkit-pkla-compat-0.1-4.el7.x86_64 filesystem-3.2-21.el7.x86_64 iputils-20160308-8.el7.x86_64 basesystem-10.0-7.el7.noarch dhclient-4.2.5-47.el7.x86_64 fontpackages-filesystem-1.44-8.el7.noarch crontabs-1.11-6.20121102git.el7.noarch bind-license-9.9.4-37.el7.noarch cronie-1.4.11-14.el7_2.1.x86_64 linux-firmware-20160830-49.git7534e19.el7.noarch dracut-network-033-463.el7.x86_64 nss-softokn-freebl-3.16.2.3-14.4.el7.x86_64 rhn-client-tools-2.0.2-8.el7.noarch glibc-2.17-157.el7.x86_64 rhn-check-2.0.2-8.el7.noarch ncurses-libs-5.9-13.20130511.el7.x86_64 rhn-setup-2.0.2-8.el7.noarch libsepol-2.5-6.el7.x86_64 libdrm-2.4.67-3.el7.x86_64 libselinux-2.5-6.el7.x86_64 plymouth-0.8.9-0.26.20140113.el7.x86_64 info-5.1-4.el7.x86_64 pciutils-3.5.1-1.el7.x86_64 sed-4.2.2-5.el7.x86_64 wpa_supplicant-2.0-20.el7.x86_64 libuuid-2.23.2-33.el7.x86_64 trousers-0.3.13-1.el7.x86_64 grep-2.20-2.el7.x86_64 glib-networking-2.42.0-1.el7.x86_64 chkconfig-1.7.2-1.el7.x86_64 net-tools-2.0-0.17.20131004git.el7.x86_64 bzip2-libs-1.0.6-13.el7.x86_64 ppp-2.4.5-33.el7.x86_64 libxml2-2.9.1-6.el7_2.3.x86_64 fxload-2002_04_11-16.el7.x86_64 expat-2.1.0-8.el7.x86_64 alsa-tools-firmware-1.1.0-1.el7.x86_64 readline-6.2-9.el7.x86_64 libthai-0.1.14-9.el7.x86_64 libffi-3.0.13-18.el7.x86_64 libtiff-4.0.3-25.el7_2.x86_64 glib2-2.46.2-4.el7.x86_64 libX11-common-1.6.3-3.el7.noarch dbus-libs-1.6.12-17.el7.x86_64 libXext-1.3.3-3.el7.x86_64 libcap-ng-0.7.5-4.el7.x86_64 libXfixes-5.0.1-2.1.el7.x86_64 libgcrypt-1.5.3-12.el7_1.1.x86_64 libXdamage-1.1.4-4.1.el7.x86_64 libattr-2.4.46-12.el7.x86_64 libXinerama-1.1.3-2.1.el7.x86_64 libcap-2.22-8.el7.x86_64 libXtst-1.2.2-2.1.el7.x86_64 which-2.20-7.el7.x86_64 libXft-2.3.2-2.el7.x86_64 glibmm24-2.42.0-1.el7.x86_64 mesa-libGL-11.2.2-2.20160614.el7.x86_64 elfutils-libs-0.166-2.el7.x86_64 cairo-1.14.2-1.el7.x86_64 lua-5.1.4-15.el7.x86_64 cairomm-1.10.0-8.el7.x86_64 diffutils-3.3-4.el7.x86_64 libXcomposite-0.4.4-4.1.el7.x86_64 atk-2.14.0-1.el7.x86_64 gtkmm24-2.24.2-8.el7.x86_64 libpng-1.5.13-7.el7_2.x86_64 firewalld-0.4.3.2-8.el7.noarch file-5.11-33.el7.x86_64 kbd-1.15.5-12.el7.x86_64 pciutils-libs-3.5.1-1.el7.x86_64 NetworkManager-tui-1.4.0-12.el7.x86_64 libmnl-1.0.3-7.el7.x86_64 rdma-7.3_4.7_rc2-5.el7.noarch nss-softokn-3.16.2.3-14.4.el7.x86_64 grub2-2.02-0.44.el7.x86_64 tar-1.26-31.el7.x86_64 tuned-2.7.1-3.el7.noarch libcroco-0.6.8-5.el7.x86_64 audit-2.6.5-3.el7.x86_64 cyrus-sasl-lib-2.1.26-20.el7_2.x86_64 openssh-server-6.6.1p1-31.el7.x86_64 groff-base-1.22.2-8.el7.x86_64 aic94xx-firmware-30-6.el7.noarch xz-5.2.2-1.el7.x86_64 microcode_ctl-2.1-16.el7.x86_64 libgomp-4.8.5-11.el7.x86_64 dracut-config-rescue-033-463.el7.x86_64 libedit-3.0-12.20121213cvs.el7.x86_64 selinux-policy-targeted-3.13.1-102.el7.noarch libtasn1-3.8-3.el7.x86_64 authconfig-6.2.8-14.el7.x86_64 ca-certificates-2015.2.6-73.el7.noarch man-db-2.6.3-9.el7.x86_64 newt-0.52.15-4.el7.x86_64 redhat-support-tool-0.9.8-6.el7.noarch gdbm-1.10-8.el7.x86_64 Red_Hat_Enterprise_Linux-Release_Notes-7-en-US-7-2.el7.noarch libnfnetlink-1.0.1-4.el7.x86_64 xfsprogs-4.5.0-8.el7.x86_64 lzo-2.06-8.el7.x86_64 e2fsprogs-1.42.9-9.el7.x86_64 libxshmfence-1.2-1.el7.x86_64 iwl2000-firmware-18.168.6.1-49.el7.noarch ethtool-4.5-3.el7.x86_64 rootfiles-8.1-11.el7.noarch iptables-1.4.21-17.el7.x86_64 iwl6000-firmware-9.221.4.1-49.el7.noarch gettext-libs-0.18.2.1-4.el7.x86_64 ivtv-firmware-20080701-26.el7.noarch libteam-1.25-4.el7.x86_64 iwl7260-firmware-22.0.7.0-49.el7.noarch ipset-6.19-6.el7.x86_64 iwl6050-firmware-41.28.5.1-49.el7.noarch nettle-2.7.1-8.el7.x86_64 iwl7265-firmware-22.0.7.0-49.el7.noarch vim-minimal-7.4.160-1.el7.x86_64 iwl2030-firmware-18.168.6.1-49.el7.noarch libxslt-1.1.28-5.el7.x86_64 iwl5000-firmware-8.83.5.1_1-49.el7.noarch dbus-glib-0.100-7.el7.x86_64 NetworkManager-config-server-1.4.0-12.el7.x86_64 gsettings-desktop-schemas-3.14.2-1.el7.x86_64 pinentry-0.8.1-17.el7.x86_64 mozjs17-17.0.0-19.el7.x86_64 GeoIP-1.5.0-11.el7.x86_64 ncurses-5.9-13.20130511.el7.x86_64 harfbuzz-0.9.36-1.el7.x86_64 libproxy-0.4.11-10.el7.x86_64 libnl-1.1.4-3.el7.x86_64 krb5-libs-1.14.1-26.el7.x86_64 coreutils-8.22-18.el7.x86_64 python-2.7.5-48.el7.x86_64 dbus-python-1.1.1-9.el7.x86_64 fontconfig-2.10.95-10.el7.x86_64 python-dateutil-1.5-7.el7.noarch python-decorator-3.4.0-3.el7.noarch newt-python-0.52.15-4.el7.x86_64 cracklib-dicts-2.9.0-11.el7.x86_64 pam-1.1.8-18.el7.x86_64 libgudev1-219-30.el7.x86_64 libmount-2.23.2-33.el7.x86_64 gettext-0.18.2.1-4.el7.x86_64 redhat-logos-70.0.3-6.el7.noarch plymouth-core-libs-0.8.9-0.26.20140113.el7.x86_64 grubby-8.28-18.el7.x86_64 python-gudev-147.2-7.el7.x86_64 pyliblzma-0.5.3-11.el7.x86_64 libselinux-python-2.5-6.el7.x86_64 python-slip-dbus-0.4.0-2.el7.noarch python-magic-5.11-33.el7.noarch python-dmidecode-3.10.13-11.el7.x86_64 python-perf-3.10.0-514.el7.x86_64 rhnlib-2.5.65-2.el7.noarch binutils-2.25.1-22.base.el7.x86_64 openssl-1.0.1e-60.el7.x86_64 nss-sysinit-3.21.0-17.el7.x86_64 nss-tools-3.21.0-17.el7.x86_64 mariadb-libs-5.5.52-1.el7.x86_64 fipscheck-lib-1.4.1-5.el7.x86_64 cups-libs-1.6.3-26.el7.x86_64 libcurl-7.29.0-35.el7.x86_64 rpm-libs-4.11.3-21.el7.x86_64 openldap-2.4.40-13.el7.x86_64 dhcp-libs-4.2.5-47.el7.x86_64 passwd-0.79-4.el7.x86_64 python-urlgrabber-3.10-8.el7.noarch hardlink-1.0-19.el7.x86_64 gnupg2-2.0.22-4.el7.x86_64 pygpgme-0.3-9.el7.x86_64 rpm-python-4.11.3-21.el7.x86_64 python-rhsm-1.17.9-1.el7.x86_64 dmidecode-3.0-2.el7.x86_64 numactl-libs-2.0.9-6.el7_2.x86_64 libpipeline-1.2.3-3.el7.x86_64 libdnet-1.12-13.1.el7.x86_64 libmspack-0.5-0.4.alpha.el7.x86_64 libXau-1.0.8-2.1.el7.x86_64 ustr-1.0.4-16.el7.x86_64 shadow-utils-4.1.5.1-24.el7.x86_64 util-linux-2.23.2-33.el7.x86_64 virt-what-1.13-8.el7.x86_64 usermode-1.111-5.el7.x86_64 libdaemon-0.14-7.el7.x86_64 qrencode-libs-3.4.1-3.el7.x86_64 device-mapper-1.02.135-1.el7.x86_64 cryptsetup-libs-1.7.2-1.el7.x86_64 kmod-20-9.el7.x86_64 dbus-1.6.12-17.el7.x86_64 libgcc-4.8.5-11.el7.x86_64 polkit-0.112-9.el7.x86_64 setup-2.8.71-7.el7.noarch hwdata-0.252-8.4.el7.x86_64 tzdata-2016g-2.el7.noarch initscripts-9.49.37-1.el7.x86_64 emacs-filesystem-24.3-18.el7.noarch os-prober-1.58-9.el7.x86_64 kbd-legacy-1.15.5-12.el7.noarch cronie-anacron-1.4.11-14.el7_2.1.x86_64 python-rhsm-certificates-1.17.9-1.el7.x86_64 grub2-tools-2.02-0.44.el7.x86_64 ncurses-base-5.9-13.20130511.el7.noarch python-hwdata-1.7.3-4.el7.noarch glibc-common-2.17-157.el7.x86_64 yum-rhn-plugin-2.0.1-6.el7.noarch libstdc++-4.8.5-11.el7.x86_64 rhnsd-5.0.13-5.el7.x86_64 bash-4.2.46-20.el7_2.x86_64 libpciaccess-0.13.4-2.el7.x86_64 pcre-8.32-15.el7_2.1.x86_64 plymouth-scripts-0.8.9-0.26.20140113.el7.x86_64 zlib-1.2.7-17.el7.x86_64 mesa-libgbm-11.2.2-2.20160614.el7.x86_64 xz-libs-5.2.2-1.el7.x86_64 dnsmasq-2.66-21.el7.x86_64 nspr-4.11.0-1.el7_2.x86_64 ebtables-2.0.10-15.el7.x86_64 libcom_err-1.42.9-9.el7.x86_64 gnutls-3.3.24-1.el7.x86_64 popt-1.13-16.el7.x86_64 libsoup-2.48.1-6.el7.x86_64 nss-util-3.21.0-2.2.el7_2.x86_64 open-vm-tools-10.0.5-2.el7.x86_64 libdb-5.3.21-19.el7.x86_64 NetworkManager-1.4.0-12.el7.x86_64 freetype-2.4.11-12.el7.x86_64 alsa-firmware-1.0.28-2.el7.noarch gawk-4.0.2-4.el7.x86_64 libestr-0.1.9-2.el7.x86_64 elfutils-libelf-0.166-2.el7.x86_64 jbigkit-libs-2.0-11.el7.x86_64 pkgconfig-0.27.1-4.el7.x86_64 kbd-misc-1.15.5-12.el7.noarch shared-mime-info-1.1-9.el7.x86_64 libX11-1.6.3-3.el7.x86_64 libgpg-error-1.12-3.el7.x86_64 libXrender-0.9.8-2.1.el7.x86_64 audit-libs-2.6.5-3.el7.x86_64 libXi-1.7.4-2.el7.x86_64 libsigc++20-2.3.1-4.el7.x86_64 libXrandr-1.4.2-2.el7.x86_64 libacl-2.2.51-12.el7.x86_64 gdk-pixbuf2-2.31.6-3.el7.x86_64 cpio-2.11-24.el7.x86_64 libXcursor-1.1.14-2.1.el7.x86_64 libnl3-3.2.28-2.el7.x86_64 libXxf86vm-1.1.3-2.1.el7.x86_64 p11-kit-0.20.7-3.el7.x86_64 mesa-libEGL-11.2.2-2.20160614.el7.x86_64 sqlite-3.7.17-8.el7.x86_64 pango-1.36.8-2.el7.x86_64 findutils-4.5.11-5.el7.x86_64 pangomm-2.34.0-3.el7.x86_64 jansson-2.4-6.el7.x86_64 gtk2-2.24.28-8.el7.x86_64 libidn-1.28-4.el7.x86_64 firewalld-filesystem-0.4.3.2-8.el7.noarch file-libs-5.11-33.el7.x86_64 open-vm-tools-desktop-10.0.5-2.el7.x86_64 gmp-6.0.0-12.el7_1.x86_64 rsyslog-7.4.7-16.el7.x86_64 libjpeg-turbo-1.2.90-5.el7.x86_64 NetworkManager-team-1.4.0-12.el7.x86_64 atkmm-2.22.7-3.el7.x86_64 kexec-tools-2.0.7-50.el7.x86_64 libnl3-cli-3.2.28-2.el7.x86_64 kernel-3.10.0-514.el7.x86_64 libassuan-2.1.0-3.el7.x86_64 postfix-2.10.1-6.el7.x86_64 gobject-introspection-1.42.0-1.el7.x86_64 irqbalance-1.0.7-6.el7.x86_64 e2fsprogs-libs-1.42.9-9.el7.x86_64 chrony-2.1.1-3.el7.x86_64 kmod-libs-20-9.el7.x86_64 biosdevname-0.7.2-1.el7.x86_64 libunistring-0.9.3-9.el7.x86_64 subscription-manager-1.17.15-1.el7.x86_64 mesa-libglapi-11.2.2-2.20160614.el7.x86_64 parted-3.1-28.el7.x86_64 libicu-50.1.2-15.el7.x86_64 openssh-clients-6.6.1p1-31.el7.x86_64 p11-kit-trust-0.20.7-3.el7.x86_64 iprutils-2.4.13.1-1.el7.x86_64 slang-2.2.4-11.el7.x86_64 kernel-tools-3.10.0-514.el7.x86_64 fuse-libs-2.9.2-7.el7.x86_64 sudo-1.8.6p7-20.el7.x86_64 sysvinit-tools-2.88-14.dsf.el7.x86_64 Red_Hat_Enterprise_Linux-Release_Notes-7-zh-CN-7-2.2.el7.noarch tcp_wrappers-libs-7.6-77.el7.x86_64 btrfs-progs-4.4.1-1.el7.x86_64 hostname-3.13-3.el7.x86_64 libsysfs-2.1.0-16.el7.x86_64 keyutils-libs-1.5.8-3.el7.x86_64 iwl1000-firmware-39.31.5.1-49.el7.noarch libnetfilter_conntrack-1.0.4-2.el7.x86_64 iwl5150-firmware-8.24.2.2-49.el7.noarch iproute-3.10.0-74.el7.x86_64 iwl3160-firmware-22.0.7.0-49.el7.noarch less-458-9.el7.x86_64 iwl135-firmware-18.168.6.1-49.el7.noarch ipset-libs-6.19-6.el7.x86_64 iwl3945-firmware-15.32.2.9-49.el7.noarch jasper-libs-1.900.1-29.el7.x86_64 iwl100-firmware-39.31.5.1-49.el7.noarch fuse-2.9.2-7.el7.x86_64 iwl6000g2b-firmware-17.168.5.2-49.el7.noarch acl-2.2.51-12.el7.x86_64 iwl6000g2a-firmware-17.168.5.3-49.el7.noarch avahi-libs-0.6.31-17.el7.x86_64 iwl4965-firmware-228.61.2.24-49.el7.noarch desktop-file-utils-0.22-1.el7.x86_64 iwl105-firmware-18.168.6.1-49.el7.noarch libdb-utils-5.3.21-19.el7.x86_64 libss-1.42.9-9.el7.x86_64 make-3.82-23.el7.x86_64 libselinux-utils-2.5-6.el7.x86_64 graphite2-1.3.6-1.el7_2.x86_64 libmodman-2.0.1-8.el7.x86_64 snappy-1.1.0-3.el7.x86_64 libverto-0.2.5-4.el7.x86_64 openssl-libs-1.0.1e-60.el7.x86_64 python-libs-2.7.5-48.el7.x86_64 libblkid-2.23.2-33.el7.x86_64 gzip-1.5-8.el7.x86_64 python-iniparse-0.4-9.el7.noarch cracklib-2.9.0-11.el7.x86_64 pygobject3-base-3.14.0-3.el7.x86_64 m2crypto-0.21.1-17.el7.x86_64 libpwquality-1.2.3-4.el7.x86_64 systemd-libs-219-30.el7.x86_64 procps-ng-3.3.10-10.el7.x86_64 python-lxml-3.2.1-4.el7.x86_64 python-ethtool-0.8-5.el7.x86_64 xdg-utils-1.1.0-0.17.20120809git.el7.noarch python-pyudev-0.15-7.el7_2.1.noarch pygobject2-2.28.6-11.el7.x86_64 python-configobj-4.7.2-7.el7.noarch yum-metadata-parser-1.1.4-10.el7.x86_64 python-slip-0.4.0-2.el7.noarch python-firewall-0.4.3.2-8.el7.noarch libxml2-python-2.9.1-6.el7_2.3.x86_64 pyxattr-0.5.1-5.el7.x86_64 pyOpenSSL-0.13.1-3.el7.x86_64 logrotate-3.8.6-12.el7.x86_64 alsa-lib-1.1.1-1.el7.x86_64 nss-3.21.0-17.el7.x86_64 NetworkManager-libnm-1.4.0-12.el7.x86_64 hicolor-icon-theme-0.12-7.el7.noarch bind-libs-lite-9.9.4-37.el7.x86_64 fipscheck-1.4.1-5.el7.x86_64 libssh2-1.4.3-10.el7_2.1.x86_64 curl-7.29.0-35.el7.x86_64 rpm-4.11.3-21.el7.x86_64 libuser-0.60-7.el7_1.x86_64 dhcp-common-4.2.5-47.el7.x86_64 python-pycurl-7.19.0-19.el7.x86_64 pixman-0.34.0-1.el7.x86_64 pth-2.0.7-23.el7.x86_64 gpgme-1.3.2-5.el7.x86_64 rpm-build-libs-4.11.3-21.el7.x86_64 yum-3.4.3-150.el7.noarch redhat-support-lib-python-0.9.7-6.el7.noarch kernel-tools-libs-3.10.0-514.el7.x86_64 libndp-1.2-7.el7.x86_64 lsscsi-0.27-4.el7.x86_64 json-c-0.11-4.el7_0.x86_64 libpcap-1.5.3-8.el7.x86_64 libxcb-1.11-4.el7.x86_64 libsemanage-2.5-4.el7.x86_64 libutempter-1.1.6-4.el7.x86_64 policycoreutils-2.5-8.el7.x86_64 openssh-6.6.1p1-31.el7.x86_64 selinux-policy-3.13.1-102.el7.noarch teamd-1.25-4.el7.x86_64 kpartx-0.4.9-99.el7.x86_64 device-mapper-libs-1.02.135-1.el7.x86_64 dracut-033-463.el7.x86_64 systemd-219-30.el7.x86_64"
[ -d ./Packages ] || mkdir ./Packages
for i in ${pack}
do
	cp -rf ${cdrom}/Packages/${i}.rpm ./Packages 2> /dev/null 
done
sed -i '/initrd/c\\tappend initrd=initrd.img ks=cdrom:/isolinux/ks.cfg quiet' ./isolinux/isolinux.cfg
sed -i 's/Red Hat Enterprise Linux 7.3/Auto Install Linux by YGS/' ./isolinux/isolinux.cfg
sed -i '/timeout/ctimeout 50' ./isolinux/isolinux.cfg
sed -i '/menu default/d' isolinux/isolinux.cfg
sed -i '/label linux/amenu default' isolinux/isolinux.cfg
[ -d isolinux/ks.cfg ] || touch ./isolinux/ks.cfg
ks_value="install\nkeyboard 'us'\nrootpw --plaintext 123456\nlang zh_CN.UTF-8\nfirewall --disabled\nauth  --useshadow  --passalgo=sha512\ncdrom\ntext\nfirstboot --enable\nselinux --disabled\nnetwork  --bootproto=dhcp --device=etho\nreboot\ntimezone Asia/Shanghai\nbootloader --location=mbr\nclearpart --all\npart swap --fstype="swap" --size=2048\npart /boot --fstype="ext4" --size=200\npart / --fstype="ext4" --size=10240\n%packages\n@core\n%end\n%post\nid ygs 2> /dev/null || useradd ygs\necho 123456 | passwd --stdin ygs\ncat >> /etc/yum.repos.d/base.repo << eof\n[base]\nname=baseserver\nbaseurl=file:///mnt/\nenable=1\ngpgcheck=0\neof\n%end"
echo -e ${ks_value} > ./isolinux/ks.cfg
mkisofs -R -J -T -v -no-emul-boot -boot-load-size 4 -boot-info-table -V RHEL7 -b isolinux/isolinux.bin -c isolinux/boot.cat -o /RH_text_by_ygs.iso .
